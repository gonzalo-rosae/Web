<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal - Principal</title>
    <link rel="icon" href="../imagenes/favicon.ico" type="images/x-icon">
    <script src="../scripts/general.js"></script>
    <link rel="stylesheet" href="../estilos/general.css">
    <link rel="stylesheet" href="../estilos/home.css">
</head>

<body>
    <a id="flechaAtras" href="javascript:void(0);" onclick="window.history.back();">←</a>
    <div class="container">
        <h1 id="greeting">Hola, Usuario</h1>
        <div class="button-container">
            <button id="btnConsonantes" class="custom-button" onclick="goToPage('consonantes')"><span
                    class="textoBtn">Consonantes</span></button>
            <button id="btnVocales" class="custom-button prohibido" onclick="prohibido()"><span
                    class="textoBtn">Vocales</span></button>
        </div>
    </div>

    <script>
        window.onload = function () {
            const identifier = sessionStorage.getItem('userIdentifier');
            const token = sessionStorage.getItem('authToken');

            if (identifier && isValidToken(token, identifier)) {
                document.getElementById('greeting').textContent = `Bienvenido, ${identifier}`;
            } else {
                redirectToLogin();
            }
        }

        function isValidToken(token, identifier) {
            try {
                const decodedToken = atob(token);
                const [storedIdentifier, timestamp, _] = decodedToken.split(':');

                // Verificar que el identificador en el token coincide con el almacenado
                if (storedIdentifier !== identifier) return false;

                // Verificar que el token no tiene más de 1 hora de antigüedad
                const tokenAge = Date.now() - parseInt(timestamp);
                if (tokenAge > 3600000) return false; // 3600000 ms = 1 hora

                return true;
            } catch (e) {
                return false; // Si hay algún error en la decodificación, el token no es válido
            }
        }

        function goToPage(page) {
            window.location.href = "./" + page + ".html";
        }

        function redirectToLogin() {
            console.log("redirigido bitch!");
            sessionStorage.removeItem('userIdentifier');
            sessionStorage.removeItem('authToken');
            window.location.href = '../index.html';
        }
    </script>
</body>

</html>